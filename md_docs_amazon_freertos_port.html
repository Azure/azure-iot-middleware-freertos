<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Azure IoT middleware for FreeRTOS: Amazon FreeRTOS Port</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Azure IoT middleware for FreeRTOS
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Amazon FreeRTOS Port </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md38"></a>
The Porting Process</h1>
<p>Porting from Amazon FreeRTOS applications can be done using the following sections. There are several topics to cover including building, porting, authentication, and feature set.</p>
<h1><a class="anchor" id="autotoc_md39"></a>
Building</h1>
<p>Like the Amazon FreeRTOS library, we use CMake to build the middleware. You may use the directions <a href="https://github.com/Azure/azure-iot-middleware-freertos#using-cmake">here</a> to correctly set up the build environment for your project to generate and compile.</p>
<p>To see the detailed diff showing the changes in the CMake to get the sample building with the Azure IoT middleware for FreeRTOS, please see <a href="https://github.com/aws/amazon-freertos/commit/cc30c2493f13b441d3f4029aacac420756cc09f9">here</a>.</p>
<h1><a class="anchor" id="autotoc_md40"></a>
Porting</h1>
<p>If starting from a basic CoreMQTT implementation, such as <a href="https://github.com/aws/amazon-freertos/blob/main/demos/coreMQTT/mqtt_demo_mutual_auth.c">here</a>, the porting process is pretty straight forward. The network context of the Azure IoT middleware for FreeRTOS maps similarly to the usage of the CoreMQTT library as shown <a href="https://github.com/aws/amazon-freertos/blob/3af6570347e4777d43653701bcea6ea8723a63af/demos/coreMQTT/mqtt_demo_mutual_auth.c#L795-L797">here</a>.</p>
<p>For a detailed diff showing how to get telemetry data sending to Azure IoT Hub using the <code>mqtt_demo_mutual_auth.c</code> sample, please see <a href="https://github.com/aws/amazon-freertos/commit/ea766b48f0d3773c7a1e4ff30b2e2769b4fb1650">here</a>.</p>
<p>To see the combination diff of building and porting, please see <a href="https://github.com/aws/amazon-freertos/compare/main...danewalton:aws-azure-port?expand=1">here</a>. While this diff shows some specific changes for the STM32L475 Discovery board, many of the configuration values can be translated to other boards and platforms by finding their equivalent values in other board's configuration files.</p>
<h1><a class="anchor" id="autotoc_md41"></a>
Authentication</h1>
<p>Azure IoT supports x509 certificate and SAS key authentication. For details on which to use, you can refer to <a href="https://azure.microsoft.com/blog/iot-device-authentication-options/">this document going over the pros and cons of each</a>.</p>
<h2><a class="anchor" id="autotoc_md42"></a>
x509 Certificates</h2>
<p>If using x509 authentication, the integration process happens at the networking layer of the project (outside the scope of the SDK). For an example on how to add them in our samples, please see <a href="https://github.com/Azure-Samples/iot-middleware-freertos-samples/blob/98234388ec445de4fa482de54b468fee23d6a1f7/demos/sample_azure_iot/sample_azure_iot.c#L278-L281">this code snippet here</a> which uses a <code>NetworkContext_t</code> struct to pass to the chosen TLS stack layer (<a href="https://github.com/Azure-Samples/iot-middleware-freertos-samples/blob/98234388ec445de4fa482de54b468fee23d6a1f7/demos/common/transport/transport_tls_socket_using_mbedtls.c#L345-L395">in this case mbedTLS</a>). The equivalent spot to add x509 credentials in Amazon FreeRTOS would be <a href="https://github.com/aws/amazon-freertos/blob/3af6570347e4777d43653701bcea6ea8723a63af/demos/network_manager/aws_iot_network_manager.c#L887-L890">here</a>.</p>
<p>For more details on the TLS requirements of Azure IoT (TLS versions, certificate requirements, supported crypto algorithms, etc), <a href="https://docs.microsoft.com/azure/iot-hub/iot-hub-tls-support">please see this document here</a>. To see how your solution certificate requirements might need to change, please see (<a href="https://docs.aws.amazon.com/iot/latest/developerguide/transport-security.html">here for the Amazon specs.</a>)</p>
<h2><a class="anchor" id="autotoc_md43"></a>
SAS Keys</h2>
<p>Using SAS keys provides another option for your IoT solution. While we recommend x509 certificates over the use of SAS keys, SAS keys can provide their own benefits especially in prototyping. To use SAS keys, you only need to provide the symmetric key via the <a href="https://github.com/Azure/azure-iot-middleware-freertos/blob/c01460aef798d37a2f5ccf35f1f9274d34bf3d2b/source/include/azure_iot_hub_client.h#L324-L327"><code>AzureIoTHubClient_SetSymmetricKey()</code> API listed here</a> and the necessary HMAC function to use in generating the keys. The SAS key will be automatically refreshed when needed if it expires during the connection.</p>
<h1><a class="anchor" id="autotoc_md44"></a>
Platform Features</h1>
<p>Direct comparisons between feature sets of Amazon and Azure IoT is not the purpose of this document. Application code logic would need to be ported over to use Azure IoT concepts.</p>
<ul>
<li>For device-to-cloud features, please see <a href="https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-d2c-guidance">here</a>.</li>
<li>For cloud-to-device features, please see <a href="https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-c2d-guidance">here</a>.</li>
</ul>
<p>Below is a high level explanation of functional features</p>
<h2><a class="anchor" id="autotoc_md45"></a>
Telemetry</h2>
<p>Standard MQTT telemetry capability. Send messages with a payload to a pre-determined topic. Custom topics are not available at this time. <a href="https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-messages-d2c">Details for this feature can be found here</a>.</p>
<h2><a class="anchor" id="autotoc_md46"></a>
Cloud to Device Messages</h2>
<p>Essentially telemetry in the reverse direction. The cloud can send messages on a pre-determined MQTT topic for the device to process. <a href="https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-messages-c2d">Details for this feature can be found here</a>.</p>
<h2><a class="anchor" id="autotoc_md47"></a>
Commands</h2>
<p>Otherwise known as direct methods, commands/functions which one can invoke from the cloud and run on the device. These are composed of an intended function to run (name) and a possible payload to pass to the function. Any response payload and return value are then sent back to the service. <a href="https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-direct-methods">Details for this feature can be found here</a>.</p>
<h2><a class="anchor" id="autotoc_md48"></a>
Device Twin</h2>
<p>JSON documents that store device state information including metadata, configurations, and conditions. Azure IoT Hub maintains a device twin for each device that you connect to IoT Hub. <a href="https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-device-twins">Details for this feature can be found here</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
